{
  "benchmark_metadata": {
    "date": "2026-01-19T22:37:29",
    "name": "Phase 16+ Full Optimization Matrix Benchmark",
    "scale_factor": 10,
    "total_rows": 158600300,
    "total_tables": 8,
    "formats": ["orc", "parquet"],
    "optimization_modes": 9,
    "runs_per_benchmark": 2,
    "binary": "build/tpch_benchmark (38MB)"
  },
  "executive_summary": {
    "key_findings": [
      "Zero-copy optimization successfully enables ALL 8 tables (baseline only 4-5)",
      "Parquet shows stronger optimization gains: 1.65x vs ORC's 1.11x",
      "Parallel execution modes all failed - debugging needed",
      "ORC is 15-25% faster overall and significantly more stable"
    ],
    "format_comparison": {
      "orc": {
        "baseline_throughput_avg": "727K r/s (lineitem) to 3.75K r/s (region)",
        "zero_copy_speedup": "1.11x",
        "stability": "Excellent (1.7% variance)",
        "regressions": "Minimal (0.56x on tiny tables)"
      },
      "parquet": {
        "baseline_throughput_avg": "542K r/s (lineitem) to 2.5K r/s (region)",
        "zero_copy_speedup": "1.65x",
        "stability": "Poor (18.6% variance)",
        "regressions": "One catastrophic (77% on customer table with true zero-copy)"
      }
    }
  },
  "format_comparison": {
    "orc": {
      "baseline": {
        "working_tables": 4,
        "failed_tables": ["orders", "customer", "part", "supplier"],
        "largest_table_throughput": "1.13M r/s (partsupp)",
        "notes": "Missing support for 4 tables"
      },
      "zero_copy": {
        "working_tables": 8,
        "failed_tables": [],
        "avg_speedup": 1.11,
        "throughput_improvement": "lineitem +36%, partsupp +19%"
      },
      "true_zero_copy": {
        "avg_speedup": 1.11,
        "vs_zero_copy": "Minimal difference, some regressions"
      },
      "parallel_modes": "ALL FAILED"
    },
    "parquet": {
      "baseline": {
        "working_tables": 4,
        "failed_tables": ["orders", "customer", "part", "supplier"],
        "largest_table_throughput": "940K r/s (partsupp)",
        "notes": "Missing support for 4 tables, 17-26% slower than ORC"
      },
      "zero_copy": {
        "working_tables": 8,
        "failed_tables": [],
        "avg_speedup": 1.65,
        "throughput_improvement": "lineitem +52%, nation +140%"
      },
      "true_zero_copy": {
        "avg_speedup": 1.47,
        "vs_zero_copy": "High variance, customer table 77% regression"
      },
      "parallel_modes": "ALL FAILED"
    }
  },
  "performance_winners": {
    "raw_speed": "ORC (15-25% faster)",
    "stability": "ORC (1.7% vs 18.6% variance)",
    "optimization_gains": "Parquet (1.65x vs 1.11x)",
    "reliability": "ORC (no major regressions)"
  },
  "table_performance": {
    "lineitem_60m_rows": {
      "orc_baseline": "727K r/s",
      "orc_zero_copy": "993K r/s",
      "orc_speedup": "1.36x",
      "parquet_baseline": "542K r/s",
      "parquet_zero_copy": "824K r/s",
      "parquet_speedup": "1.52x",
      "winner": "ORC zero-copy (993K r/s)"
    },
    "partsupp_80m_rows": {
      "orc_baseline": "1.13M r/s",
      "orc_zero_copy": "1.35M r/s",
      "orc_speedup": "1.19x",
      "parquet_baseline": "940K r/s",
      "parquet_zero_copy": "1.11M r/s",
      "parquet_speedup": "1.18x",
      "winner": "ORC zero-copy (1.35M r/s)"
    },
    "orders_15m_rows": {
      "orc_baseline": "FAIL",
      "orc_zero_copy": "635K r/s",
      "parquet_baseline": "FAIL",
      "parquet_zero_copy": "631K r/s",
      "notes": "Nearly identical once enabled"
    },
    "customer_1_5m_rows": {
      "orc_zero_copy": "1.02M r/s",
      "parquet_zero_copy": "1.05M r/s",
      "parquet_true_zero_copy": "240K r/s (REGRESSION)",
      "notes": "Parquet true zero-copy catastrophic failure"
    }
  },
  "stability_analysis": {
    "orc_variance": {
      "baseline": "N/A (only 2 tables with data)",
      "zero_copy": "1.7% average std dev",
      "true_zero_copy": "1.2% average std dev"
    },
    "parquet_variance": {
      "baseline": "N/A (only 2 tables with data)",
      "zero_copy": "18.6% average std dev (HIGH)",
      "true_zero_copy": "21.1% average std dev (VERY HIGH)"
    },
    "critical_variance_areas": [
      "Parquet lineitem zero-copy: 20.9%",
      "Parquet part zero-copy: 52.2%",
      "Parquet customer true-zero-copy: 80.3%"
    ]
  },
  "issues_found": [
    {
      "severity": "CRITICAL",
      "category": "Parallel Execution",
      "description": "All 6 parallel mode variants failed for both ORC and Parquet",
      "impact": "Cannot assess multi-table parallel benefits"
    },
    {
      "severity": "HIGH",
      "category": "Parquet Stability",
      "description": "High variance in Parquet performance (18.6% vs ORC's 1.7%)",
      "tables_affected": ["lineitem", "part", "customer"],
      "impact": "Results less reliable for performance comparisons"
    },
    {
      "severity": "HIGH",
      "category": "True Zero-Copy Regression",
      "description": "Parquet customer table 77% regression with true zero-copy",
      "performance": "1.05M -> 240K r/s",
      "impact": "True zero-copy may not be recommended for Parquet"
    },
    {
      "severity": "MEDIUM",
      "category": "Baseline Coverage",
      "description": "Baseline mode missing support for 4 tables (orders, customer, part, supplier)",
      "workaround": "Use zero-copy optimization"
    }
  ],
  "recommendations": {
    "immediate_actions": [
      "Debug parallel mode failures - essential for complete benchmarking",
      "Investigate Parquet variance sources - identify contention/lock issues",
      "Root cause analysis on Parquet true zero-copy regressions",
      "Profile to understand 15-25% ORC performance advantage"
    ],
    "format_selection_guide": {
      "use_orc_when": [
        "Need maximum raw performance",
        "Require stable, predictable results",
        "Benchmarking consistency is critical",
        "Large tables (50M+ rows)"
      ],
      "use_parquet_when": [
        "Optimization gains are priority",
        "Working with smaller datasets where variance less critical",
        "Stick to zero-copy optimization (avoid true zero-copy)",
        "Need broader table support in baseline (but still use zero-copy)"
      ]
    },
    "optimization_recommendations": {
      "orc": "Deploy zero-copy (1.11x gain), monitor true zero-copy",
      "parquet": "Deploy zero-copy (1.65x gain), avoid true zero-copy due to regressions"
    }
  },
  "test_matrix_status": {
    "orc_baseline_per_table": "✅ Complete (4 of 8 tables)",
    "orc_zero_copy_per_table": "✅ Complete (8 of 8 tables)",
    "orc_true_zero_copy_per_table": "✅ Complete (8 of 8 tables)",
    "orc_parallel_modes": "❌ All failed",
    "parquet_baseline_per_table": "✅ Complete (4 of 8 tables)",
    "parquet_zero_copy_per_table": "✅ Complete (8 of 8 tables)",
    "parquet_true_zero_copy_per_table": "✅ Complete (8 of 8 tables)",
    "parquet_parallel_modes": "❌ All failed",
    "overall_completion": "67% (6/9 modes per format)"
  },
  "data_location": "/home/tsafin/src/tpch-cpp/benchmark-results/phase16_sf10_benchmark/"
}
